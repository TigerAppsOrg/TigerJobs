<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TigerJobs</title>
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css' rel='stylesheet'>
    <link href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css' rel='stylesheet'>
    <!------------------------JS/CSS/JQuery/Bootstrap src ------------>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <!-- CSS stylesheet  -->
    <link rel="stylesheet" type="text/css" href="../static/app.css">
    <style type="text/css"></style>
</head>

<body>
    <!-- Navbar -->
    {% include 'templates/navbar.html' %}
    <!-- Content -->
    <div class="top-container-profile">
        <div class="row profile-row">
            <div class="col-sm profile-col">
                <div class="blurb-bg">
                    <div>
                        <h2>Welcome, {{netid}}.</h2>
                        <p>
                            Fill in your personal info here! Your responses will be added to any review you submit, 
                            but your netid will stay private. You may update your background as you see fit.
                            
                        </p>
                    </div>
                    {% include 'templates/profileform.html' %}
                </div>
                <br>
                <div class="blurb-bg">
                    <h2>Your stats</h2>
                    <p>
                        Here is a summary of your contributions to TigerJobs so far :)
                    </p>
                    <p><b>Total <span class="lightblue">job reviews</span>:</b>&nbsp;{{internships|length}}</p>
                    <p><b>Total <span class="yellow">interview reviews</span>:</b>&nbsp;{{interviews|length}}</p>
                    <p><b>Amount of upvotes on your <span class="lightblue">job reviews</span>:</b>&nbsp;{{my_internship_upvotes}}</p>
                    <p><b>Amount of upvotes on your <span class="yellow">interview reviews</span>:</b>&nbsp;{{my_interview_upvotes}}</p>
                    <p><b>Amount of <span class="lightblue">job reviews</span> you've upvoted:</b>&nbsp;{{upvote_internships|length}}</p>
                    <p><b>Amount of <span class="yellow">interview reviews</span> you've upvoted:</b>&nbsp;{{upvote_interviews|length}}</p>
                </div>
            </div>
            <div class="col-sm profile-col">
                <div class="blurb-bg">
                    <h2>Add a review!</h2>
                    <p>
                        Add a job or interview review
                        to help your fellow Princeton students. Make sure
                        you've filled out your personal info before you submit
                        a review.
                    </p>
                    <br>
                    <div class="center-container">
                        <button class="profile-btn" data-bs-toggle="modal" data-bs-target="#addReviewModal"><b>Leave a review</b></button>
                    </div>
                </div>
                <br>
                <div class="blurb-bg">
                    <h2>Your reviews</h2>
                    <p>
                        Here is a list of all the reviews you've posted :)
                    </p>
                    {% include 'templates/profilereviews.html' %}
                </div>
                <br>
                <div class="blurb-bg">
                    <h2>Upvoted reviews</h2>
                    <p>
                        Here is a list of all the reviews you've upvoted :)
                    </p>
                    {% include 'templates/profileupvoted.html' %}
                </div>
            </div>
        </div>
    </div>
    {% include 'templates/profileaddreviewform.html' %}
    {% include 'templates/modalsuccess.html' %}
    {% include 'templates/modalerror.html' %}
    <script>
        let request = null;
        function updateProfile() {
            // Get data from form
            var profile_certificates = ""
            var certs = $('#chosen-certificates')[0].children;
            for (let i = 0; i < certs.length; i++) {
                var inner = certs[i].innerHTML;
                var cert = inner.substring(0, inner.length - 85);
                profile_certificates += cert + ", ";
            }
            profile_certificates = profile_certificates.substring(0, profile_certificates.length - 2);
            var profile_major = $('#profile-major').val();
            var profile_year = $('#profile-year').val();
            var json_event = {
                "major": profile_major,
                "certificates": profile_certificates,
                "grade": profile_year
            };
            if (request != null)
                request.abort();
            request = $.post("/profile/update", {
                dataType: 'json',
                contentType: 'application/json',
                event_data: JSON.stringify(json_event)
            }).done(function (data) {
                $('#profile-form').html(data);
                $('#modalSuccessBody').html("Your profile was successfully updated!")
                $('#modalSuccess').modal('show');
                startAutocomplete();
            }).fail(function (jqXHR, textStatus, errorThrown) {
                $('#modalErrorBody').html("There was an error updating your information. Try again!")
                $('#modalError').modal('show');
                startAutocomplete();
            });
        }

        function startAutocomplete() {
            // Set up autocomplete with certificates
            var certificates = [
                'African American Studies', 'African Studies', 'American Studies',
                'Applications of Computing', 'Applied and Computational Mathematics',
                'Archaeology', 'Architecture and Engineering', 'Asian American Studies',
                'Biophysics', 'Cognitive Science', 'Contemporary European Politics and Society',
                'Creative Writing', 'Dance', 'East Asian Studies', 'Engineering Biology',
                'Engineering Physics', 'Entrepreneurship', 'Environmental Studies',
                'European Cultural Studies', 'Finance', 'Gender and Sexuality Studies',
                'Geological Engineering', 'Global Health and Health Policy', 'Hellenic Studies',
                'History and the Practice of Diplomacy', 'Humanistic Studies', 'Jazz Studies',
                'Journalism', 'Judaic Studies', 'Language and Culture', 'Latin American Studies',
                'Latino Studies', 'Linguistics', 'Materials Science and Engineering',
                'Medieval Studies', 'Music Performance', 'Music Theater', 'Near Eastern Studies',
                'Neuroscience', 'Optimization and Quantitative Decision Science',
                'Planets and Life', 'Quantitative and Computational Biology',
                'Robotics and Intelligent Systems', 'Russian, East European and Eurasian Studies',
                'South Asian Studies', 'Statistics and Machine Learning', 'Sustainable Energy',
                'Teacher Preparation', 'Technology and Society', 'Theater',
                'Translation and Intercultural Communication', 'Urban Studies',
                'Values and Public Life', 'Visual Arts'
            ]
            // Setup autocomplete for profile form
            autocomplete_profile(document.getElementById("profile-certificates"), certificates);
        }

        function setup() {
            startAutocomplete();
            $('#job-reviews').collapse({
                toggle: false
            })
            $('#interview-reviews').collapse({
                toggle: false
            })
        }

        $('document').ready(setup);
    </script>
</body>

</html>